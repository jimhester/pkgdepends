<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>The download progress bar — pkgdepends-download-progress-bar • pkgdepends</title>


<!-- jquery -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
<!-- Bootstrap -->

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous" />

<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script>

<!-- bootstrap-toc -->
<link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script>

<!-- Font Awesome icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous" />

<!-- clipboard.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script>

<!-- headroom.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script>

<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script>




<meta property="og:title" content="The download progress bar — pkgdepends-download-progress-bar" />
<meta property="og:description" content="This is a short summary of the design of the download progress bar.

" />




<!-- mathjax -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->



  </head>

  <body data-spy="scroll" data-target="#toc">
    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">pkgdepends</a>
        <span class="version label label-danger" data-toggle="tooltip" data-placement="bottom" title="Unreleased version">0.0.0.9006</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="../articles/pkgdepends-how-to.html">pkgdepends HOWTO</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://github.com/r-lib/pkgdepends/">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
      
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header>

<div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>The download progress bar</h1>
    <small class="dont-index">Source: <a href='https://github.com/r-lib/pkgdepends/blob/master/R/download-progress-bar.R'><code>R/download-progress-bar.R</code></a></small>
    <div class="hidden name"><code>pkgdepends-download-progress-bar.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>This is a short summary of the design of the download progress bar.</p>
<p><link rel="stylesheet" type="text/css" href="../doc/assets/extra.css"></p>
<p><script src="../doc/assets/rd.js"></script></p>
    </div>



    <h2 class="hasAnchor" id="details"><a class="anchor" href="#details"></a>Details</h2>

    
<h3>Package sizes</h3>


<p>One difficulty here is that we don't always know the sizes of the files
we are downloading. We basically have three cases for downloads:</p><ul>
<li><p>For some, we know the sizes from the extra CRAN metadata. This is
usually correct, unless CRAN has changed the file on the web server.
If we get a size from the web server, then we'll use that.</p></li>
<li><p>For some, we do not know the size beforehand, but the web server
sends us the correct size, together with the first chunk of data.
This is typically for CRAN packages that we don't have metadata
about, Bioconductor packages, or GitHub packages for which GitHub
already knows the size.</p></li>
<li><p>For some, we do not know the size, and the web server does not tell
us the size, either. This is typically for GH packages that GH is
creating on the fly.</p></li>
</ul>

<p>So ideally we would have a different progress bar when the total
size if known.</p>

<h3>Possible information to show:</h3>

<ul>
<li><p>Visual progress bar</p></li>
<li><p>Number of packages: done / in-progress / total</p></li>
<li><p>Number of bytes: done / total (if known)</p></li>
<li><p>ETA</p></li>
<li><p>Download rate, i.e. x kB/s</p></li>
<li><p>Elapsed time</p></li>
<li><p>Percent of packages done</p></li>
<li><p>Percent of bytes done</p></li>
<li><p>Spinner to show that we are still working, although updating ETA is
good as well...</p></li>
<li><p>Events, e.g. got a package, downloading, or starting...</p></li>
</ul>


<h3>All package sizes are known</h3>
<pre>230 kB/s (#####      ) 45% | 14/56 pkgs | ETA ~34s | Getting dplyr
</pre>
<ul>
<li><p>Rate is informative, serves as an "alive" indicator as well.</p></li>
<li><p>Bar is visual.</p></li>
<li><p>Percent is the best quantitative measure.</p></li>
<li><p>Done/total packages is informative, not so much for the download
but the whole installation.</p></li>
<li><p>ETA is informative.</p></li>
<li><p>Event is nice, and it fills the space...</p></li>
<li><p>We don't show current/total bytes, shoulwd we? Quite wide...</p></li>
</ul>


<h3>Some package sizes are unknown</h3>
<pre>230 kB/s (#####      ) 45% | 14/56 pkgs | Getting dplyr
</pre>
<ul>
<li><p>Percent is for the packages, not bytes.</p></li>
<li><p>We can't really show ETA.</p></li>
</ul>


<h3>Events</h3>


<p>This is quite simple currently, we just print the packages we are
"getting" currently, i.e. the packages we received data for in the
last time slot.</p>

<h3>Rate (download "speed")</h3>


<p>To calculate the rate we need to record when the various data chunks
have arrived. We only do this with a resolution of 1s. We create an
environment called chunks, and for every second since the downloads have
started we record the number of bytes that arrived in that second.</p>
<p>When calculating the rate, we take the data for the last 4 seconds,
and normalize it to per second, while taking into account that the
data for the last (current) second is incomplete.</p>
<p>In the first 3 seconds we use all the available data.</p>


  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top">
      <h2 data-toc-skip>Contents</h2>
    </nav>
  </div>
</div>


      <footer>
      <div class="copyright">
  <p>Developed by <a href='https://github.com/gaborcsardi'>Gábor Csárdi</a>.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.5.1.9000.</p>
</div>

      </footer>
   </div>

  


  </body>
</html>


