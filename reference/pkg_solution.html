<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>The dependency solver — pkg_solution • pkgdepends</title>


<!-- jquery -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
<!-- Bootstrap -->

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous" />

<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script>

<!-- bootstrap-toc -->
<link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script>

<!-- Font Awesome icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous" />

<!-- clipboard.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script>

<!-- headroom.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script>

<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script>




<meta property="og:title" content="The dependency solver — pkg_solution" />
<meta property="og:description" content="The dependency solver takes the resolution information, and works out
the exact versions of each package that must be installed, such that
version and other requirements are satisfied.

" />




<!-- mathjax -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->



  </head>

  <body data-spy="scroll" data-target="#toc">
    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">pkgdepends</a>
        <span class="version label label-danger" data-toggle="tooltip" data-placement="bottom" title="Unreleased version">0.0.0.9006</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="../articles/pkgdepends-how-to.html">pkgdepends HOWTO</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://github.com/r-lib/pkgdepends/">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
      
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header>

<div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>The dependency solver</h1>
    <small class="dont-index">Source: <a href='https://github.com/r-lib/pkgdepends/blob/master/R/solve.R'><code>R/solve.R</code></a></small>
    <div class="hidden name"><code>pkg_solution.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>The dependency solver takes the resolution information, and works out
the exact versions of each package that must be installed, such that
version and other requirements are satisfied.</p>
<p><link rel="stylesheet" type="text/css" href="../doc/assets/extra.css"></p>
<p><script src="../doc/assets/rd.js"></script></p>
    </div>



    <h2 class="hasAnchor" id="details"><a class="anchor" href="#details"></a>Details</h2>

    
<h3>Solution policies</h3>


<p>The dependency solver currently supports two policies: <code>lazy</code> and
<code>upgrade</code>. The <code>lazy</code> policy prefers to minimize installation time,
and it does not perform package upgrades, unless version requirements
require them. The <code>upgrade</code> policy prefers to update all package to
their latest possible versions, but it still considers that version
requirements.</p>

<h3>The integer problem</h3>


<p>Solving the package dependencies requires solving an integer linear
problem (ILP). This subsection briefly describes how the problem is
represented as an integer problem, and what the solution policies
exactly mean.</p>
<p>Every row of the package resolution is a candidate for the dependency
solver. In the integer problem, every candidate corresponds to a binary
variable. This is 1 if that candidate is selected as part of the
solution, and 0 otherwise.</p>
<p>The objective of the ILP minimization is defined differently for
different solution policies. The ILP conditions are the same.</p><ol>
<li><p>For the <code>lazy</code> policy, <code>installed::</code> packaged get 0 points, binary
packages 1 point, sources packages 5 points.</p></li>
<li><p>For the 'upgrade' policy, we rank all candidates for a given package
according to their version numbers, and assign more points to older
versions. Points are assigned by 100 and candidates with equal
versions get equal points. We still prefer installed packages to
binaries to source packages, so also add 0 point for already
installed candidates, 1 extra points for binaries and 5 points for
source packages.</p></li>
<li><p>For directly specified refs, we aim to install each package exactly
once. So for these we require that the variables corresponding to
the same package sum up to 1.</p></li>
<li><p>For non-direct refs (i.e. dependencies), we require that the
variables corresponding to the same package sum up to at most one.
Since every candidate has at least 1 point in the objective function
of the minimization problem, non-needed dependencies will be
omitted.</p></li>
<li><p>For direct refs, we require that their candidates satisfy their
references. What this means exactly depends on the ref types. E.g.
for CRAN packages, it means that a CRAN candidate must be selected.
For a standard ref, a GitHub candidate is OK as well.</p></li>
<li><p>We rule out candidates for which the dependency resolution failed.</p></li>
<li><p>We go over all the dependency requirements and rule out packages
that do not meet them. For every package <code>A</code>, that requires
package <code>B</code>, we select the <code>B(i, i=1..k)</code> candidates of <code>B</code> that
satisfy <code>A</code>'s requirements and add a <code>A - B(1) - ... - B(k) &lt;= 0</code>
rule. To satisfy this rule, either we cannot install <code>A</code>, or if <code>A</code>
is installed, then one of the good <code>B</code> candidates must be installed
as well.</p></li>
<li><p>We rule out non-installed CRAN and Bioconductor candidates for
packages that have an already installed candidate with the same exact
version.</p></li>
<li><p>We also rule out source CRAN and Bioconductor candidates for
packages that have a binary candidate with the same exact version.</p></li>
</ol>


<h3>Explaining why the solver failed</h3>


<p>To be able to explain why a solution attempt failed, we also add a dummy
variable for each directly required package. This dummy variable has a
very large objective value, and it is only selected if there is no
way to install the directly required package.</p>
<p>After a failed solution, we look the dummy variables that were selected,
to see which directly required package failed to solve. Then we check
which rule(s) ruled out the installation of these packages, and their
dependencies, recursively.</p>

<h3>The result</h3>


<p>The result of the solution is a <code>pkg_solution_result</code> object. It is a
named list with entries:</p><ul>
<li><p><code>status</code>: Status of the solution attempt, <code>"OK"</code> or <code>"FAILED"</code>.</p></li>
<li><p><code>data</code>: The selected candidates. This is very similar to a
<a href='pkg_resolution.html'>pkg_resolution_result</a> object, but it has two extra columns:</p><ul>
<li><p><code>lib_status</code>: status of the package in the library, after the
installation. Possible values: <code>new</code> (will be newly installed),
<code>current</code> (up to date, not installed), <code>update</code> (will be updated),
<code>no-update</code> (could update, but will not).</p></li>
<li><p><code>old_version</code>: The old (current) version of the package in the
library, or <code>NA</code> if the package is currently not installed.</p></li>
</ul></li>
<li><p><code>problem</code>: The ILP problem. The exact representation is an
implementation detail, but it does have an informative print method.</p></li>
<li><p><code>solution</code>: The return value of the internal solver.</p></li>
</ul>



  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top">
      <h2 data-toc-skip>Contents</h2>
    </nav>
  </div>
</div>


      <footer>
      <div class="copyright">
  <p>Developed by <a href='https://github.com/gaborcsardi'>Gábor Csárdi</a>.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.5.1.9000.</p>
</div>

      </footer>
   </div>

  


  </body>
</html>


